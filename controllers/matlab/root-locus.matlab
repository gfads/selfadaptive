% File: ExperimentalDesign-BasicPID-RootLocus-1.csv

clear all
yp = [261.574194 621.580645 812.503226 1060.329032 1243.445161 1476.335484 1596.154839 1717.774194 1905.277419 2026.23871 2212.43871 2368.296774 2508.290323 2651.645161 2831.812903 2651.464516 2732.012903 2852.329032 2962.651613 3052.651613 3142.012903 3308.845161 3362.529032 3310.722581 3699.980645 3782.135484 3718.206452 3910.825806 4001.425806 4145.445161 3850.548387 3950.032258 3967.083871 4010.980645 4074.329032 4263.412903 4273.593548 4538.522581 4337.56129 5050.716129 4461.754839 4493.748387 4697.6 4753.664516 5478.554839 4557.96129 4561.567742 4855.148387 4954.245161 4748.103226 4997.567742 5562.832258 4776.006452 5015.63871 4852.503226 4818.412903 4902.025806 5147.432258 5287.477419 5550.283871 5383.877419 5595.845161 5500.632258 5360.877419 5470.941935 5429.767742 5390.6 5480.716129 5424.232258 5670.006452 5594.612903 5556.122581 5613.890323 5500.819355 5632.858065 5837.180645 5767.929032 6035.76129 5768.425806 6019.225806 6292.63871 6253.135484 7040.412903 6242.16129 6230.890323 7166.832258 6611.909677 6558.219355 6395.606452 6367.645161 6373.412903 6494.470968 6641.522581 6421.058065 6575.309677 6597.864516 6485.36129 6522.651613 6238.180645 6498.025806]
up = [1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100]

maxSize = 100 % maxSize = 15 is the best rmse, r2


%mu = mean(up(1:end-1)); % Original
mu = mean(up(1:maxSize-1));

%my = mean(yp(2:end)); % Original
my = mean(yp(2:maxSize));

u = up - mu;
y = yp - my;

S = zeros(5,1);
%S(1) = sum(y(1:end-1).^2);
%S(2) = sum(u(1:end-1).*y(1:end-1));
%S(3) = sum(u(1:end-1).^2);
%S(4) = sum(y(1:end-1).*y(2:end));
%S(5) = sum(u(1:end-1).*y(2:end));

S(1) = sum(y(1:maxSize-1).^2);
S(2) = sum(u(1:maxSize-1).*y(1:maxSize-1));
S(3) = sum(u(1:maxSize-1).^2);
S(4) = sum(y(1:maxSize-1).*y(2:maxSize));
S(5) = sum(u(1:maxSize-1).*y(2:maxSize));

a = (S(3)*S(4)-S(2)*S(5))/(S(1)*S(3)-(S(2))^2);
b = (S(1)*S(5)-S(2)*S(4))/(S(1)*S(3)-(S(2))^2);

%disp([a b])
%disp([mu my])
%[a b] % a is the root
%[mu my] % operating point

yhat = a*y(1:end-1) + b*u(1:end-1); % singlestep prediction page 55
yhat2 = a*yhat(1:maxSize-1) + b*u(1:maxSize-1); % multistep prediction page 55

RMSE = rmse(y(2:maxSize),yhat2(1:maxSize-1))
R2 = 1-var([y(2:maxSize) yhat2(1:maxSize-1)])/var(y)

%disp(RMSE)
%disp(R2)
%disp(maxSize)
%disp([a b])

%plot(y(2:end),yhat, '*',y,y,'-');
%plot(y(2:maxSize),yhat(1:maxSize-1), '*',y(1:maxSize-1),y(1:maxSize-1),'-');
%ylabel("Predicted Rate")
%xlabel("Actual Rate")